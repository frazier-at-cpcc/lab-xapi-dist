{
  "version": "1.0",
  "metadata": {
    "slug": "users-password",
    "name": "Manage User Passwords",
    "description": "Set password management policy for users, and manually lock and unlock user accounts",
    "course": "rh124",
    "chapter": "Chapter 5",
    "estimated_time": "20 minutes",
    "objectives": [
      "Lock and unlock user accounts with usermod -L/-U",
      "Force password change on first login with chage -d 0",
      "Set password expiration with chage -M",
      "Set account expiration with chage -E",
      "Configure default password aging in /etc/login.defs"
    ],
    "prerequisites": [
      "Access to servera machine",
      "operator1 user exists"
    ],
    "tags": ["password", "chage", "usermod", "lock", "expiration"]
  },
  "environment": {
    "hosts": [
      {
        "name": "servera",
        "description": "Server for password management practice",
        "ssh_user": "student"
      }
    ],
    "variables": {}
  },
  "tasks": [
    {
      "id": "operator1-unlocked",
      "name": "Verify operator1 account is unlocked",
      "description": "operator1 should be able to log in (not locked)",
      "points": 1,
      "checks": [
        {
          "type": "command",
          "host": "servera",
          "user": "root",
          "command": "passwd -S operator1 | grep -v ' L '",
          "expected_exit_code": 0
        }
      ],
      "success_message": "operator1 account is unlocked",
      "failure_message": "operator1 account is still locked",
      "hints": [
        "Unlock account: sudo usermod -U operator1"
      ]
    },
    {
      "id": "password-max-age",
      "name": "Verify password expires every 90 days",
      "description": "operator1 max password age should be 90 days",
      "points": 2,
      "checks": [
        {
          "type": "command",
          "host": "servera",
          "user": "root",
          "command": "chage -l operator1 | grep 'Maximum number of days' | grep -q '90'",
          "expected_exit_code": 0
        }
      ],
      "success_message": "Password max age set to 90 days",
      "failure_message": "Password max age is not 90 days",
      "hints": [
        "Set max age: sudo chage -M 90 operator1"
      ]
    },
    {
      "id": "account-expiry",
      "name": "Verify account has expiration date",
      "description": "operator1 account should have an expiration date set (not 'never')",
      "points": 2,
      "checks": [
        {
          "type": "command",
          "host": "servera",
          "user": "root",
          "command": "chage -l operator1 | grep 'Account expires' | grep -v 'never'",
          "expected_exit_code": 0
        }
      ],
      "success_message": "Account expiration date is set",
      "failure_message": "Account expiration is set to 'never'",
      "hints": [
        "Get date 180 days from now: date -d '+180 days' +%F",
        "Set expiry: sudo chage -E YYYY-MM-DD operator1"
      ]
    },
    {
      "id": "login-defs",
      "name": "Verify PASS_MAX_DAYS set to 180 in login.defs",
      "description": "/etc/login.defs should have PASS_MAX_DAYS 180 for new users",
      "points": 2,
      "checks": [
        {
          "type": "command",
          "host": "servera",
          "command": "grep -E '^PASS_MAX_DAYS[[:space:]]+180' /etc/login.defs",
          "expected_exit_code": 0
        }
      ],
      "success_message": "PASS_MAX_DAYS set to 180 in /etc/login.defs",
      "failure_message": "PASS_MAX_DAYS not set to 180",
      "hints": [
        "Edit /etc/login.defs with: sudo vim /etc/login.defs",
        "Change PASS_MAX_DAYS to 180"
      ]
    }
  ]
}
